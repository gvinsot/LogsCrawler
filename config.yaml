# LogsCrawler Configuration
# =========================

# List of hosts to monitor
# Connection modes:
#   - "ssh": Connect via SSH (requires key-based auth)
#   - "docker": Connect via Docker API (socket or TCP)
#   - "local": Run commands locally (development only)
#
# SWARM AUTO-DISCOVERY (Recommended for Docker Swarm clusters):
# When using Docker Swarm, enable "swarm_autodiscover" on the manager node to
# automatically discover all worker nodes. No need to configure each node manually!
# The manager's Docker API handles routing commands to the correct node.
#
# Options:
#   - swarm_manager: true    - Marks this host as the Swarm manager
#   - swarm_routing: true    - Routes commands through manager (no SSH to workers)
#   - swarm_autodiscover: true - Auto-discovers all nodes in the Swarm cluster
#
# To enable Docker TCP API on the Swarm manager:
# 1. Edit /etc/docker/daemon.json and add: {"hosts": ["unix:///var/run/docker.sock", "tcp://0.0.0.0:2375"]}
# 2. Or with TLS (recommended): {"hosts": ["unix:///var/run/docker.sock", "tcp://0.0.0.0:2376"], "tls": true, ...}
# 3. Restart Docker: sudo systemctl restart docker

hosts:
  # === Docker API mode (RECOMMENDED for local monitoring) ===
  # Uses the Docker socket mounted in docker-compose.yml
  - name: "local-docker"
    mode: "docker"
    # docker_url: "unix:///var/run/docker.sock"  # Default, can be omitted
    
  # # === SSH mode for remote servers ===
  # - name: "server-z"
  #   mode: "ssh"
  #   hostname: "192.168.1.6"
  #   port: 22
  #   username: "gildas"

  # - name: "server-y"
  #   mode: "ssh"
  #   hostname: "192.168.1.172"
  #   port: 22
  #   username: "gildas"
  #   # ssh_key_path: "~/.ssh/id_rsa"  # Optional

  # === Swarm Manager with auto-discovery (RECOMMENDED for Swarm clusters) ===
  # With swarm_autodiscover enabled, worker nodes (server-b, server-c, server-d)
  # are automatically discovered - no need to configure them manually!
  - name: "server-a"
    mode: "docker"  # Use Docker API for better performance
    hostname: "192.168.1.50"
    docker_url: "tcp://192.168.1.50:2375"  # Enable Docker TCP API on manager
    swarm_manager: true      # This host is the Docker Swarm manager
    swarm_routing: true      # Route commands through manager (no SSH needed)
    swarm_autodiscover: true # Auto-discover all nodes in the Swarm cluster

  # NOTE: With swarm_autodiscover enabled, you don't need to configure
  # worker nodes manually. They will be discovered automatically from
  # the Swarm manager. The following entries are no longer needed:
  #
  # - name: "server-b"
  #   mode: "ssh"
  #   hostname: "192.168.1.30"
  #
  # - name: "server-c"
  #   mode: "ssh"
  #   hostname: "192.168.1.34"
  #
  # - name: "server-d"
  #   mode: "ssh"
  #   hostname: "192.168.1.90"

    
  # === Docker TCP mode for remote Docker hosts ===
  # - name: "remote-docker"
  #   mode: "docker"
  #   docker_url: "tcp://192.168.1.50:2375"

  # - name: "server-2"
  #   hostname: "192.168.1.11"
  #   port: 22
  #   username: "deploy"
  #   ssh_key_path: "~/.ssh/server2_key"

# OpenSearch configuration
# When running in Docker Compose, the LOGSCRAWLER_OPENSEARCH__HOSTS env var
# will override this to use the "opensearch" service name
opensearch:
  hosts:
    - "http://localhost:9200"
  index_prefix: "logscrawler"
  # username: "admin"
  # password: "admin"

# Collector settings
collector:
  # How often to fetch new logs (in seconds)
  log_interval_seconds: 30
  
  # How often to collect metrics (in seconds)
  metrics_interval_seconds: 15
  
  # Number of log lines to fetch on FIRST collection per container
  # After first fetch, ALL new logs since last timestamp are collected
  # (no lines will be missed between collections)
  log_lines_per_fetch: 500
  
  # Data retention period (days)
  retention_days: 7

# AI settings (Ollama)
ai:
  # Model to use for query conversion and log analysis
  # Recommended: qwen2.5:1.5b (fast), llama3.2:latest (better quality)
  model: "llama3.2:latest"
